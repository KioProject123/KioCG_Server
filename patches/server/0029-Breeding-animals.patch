From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Joket_abc <15005771700@qq.com>
Date: Tue, 2 Apr 2024 19:33:24 +0800
Subject: [PATCH] Breeding animals


diff --git a/src/main/java/io/papermc/paper/configuration/WorldConfiguration.java b/src/main/java/io/papermc/paper/configuration/WorldConfiguration.java
index 916b9a11955bcd99ce6a31628fdb72eb0d14730c..c08f37a5c3ce33215fd9dcaaa8ba8e92713e709e 100644
--- a/src/main/java/io/papermc/paper/configuration/WorldConfiguration.java
+++ b/src/main/java/io/papermc/paper/configuration/WorldConfiguration.java
@@ -598,6 +598,11 @@ public class WorldConfiguration extends ConfigurationPart {
             public double turretDamageDefault = 1.0;
         }
 
+        public Animal animal;
+        public class Animal extends ConfigurationPart {
+            public boolean animalCanBreed = false;
+        }
+
         public boolean betterMobGriefingSetting = true;
         public double dirtPathSpeedBoost = 0.02;
         public boolean sleepAnyTime = true;
diff --git a/src/main/java/net/minecraft/world/entity/AgeableMob.java b/src/main/java/net/minecraft/world/entity/AgeableMob.java
index 3dc3609d13a7b823d15384d1c385b68eeb933d26..c44ee87c9fc365206d9fb3b4345ed39329e984a5 100644
--- a/src/main/java/net/minecraft/world/entity/AgeableMob.java
+++ b/src/main/java/net/minecraft/world/entity/AgeableMob.java
@@ -21,6 +21,19 @@ public abstract class AgeableMob extends PathfinderMob {
     protected int forcedAge;
     protected int forcedAgeTimer;
     public boolean ageLocked; // CraftBukkit
+    // KioCG start
+    private int feedingDay;
+    private int produceDay;
+    private int totalFeedingDays;
+    private int numberOfProducedToday;
+
+    public int getTotalFeedingDays() {
+        return this.totalFeedingDays;
+    }
+    public int getNumberOfProducedToday() {
+        return this.numberOfProducedToday;
+    }
+    // KioCG end
 
     protected AgeableMob(EntityType<? extends AgeableMob> type, Level world) {
         super(type, world);
@@ -131,6 +144,12 @@ public abstract class AgeableMob extends PathfinderMob {
         nbt.putInt("Age", this.getAge());
         nbt.putInt("ForcedAge", this.forcedAge);
         nbt.putBoolean("AgeLocked", this.ageLocked); // CraftBukkit
+        // KioCG start
+        nbt.putInt("KioCG.FeedingDay", this.feedingDay);
+        nbt.putInt("KioCG.ProduceDay", this.produceDay);
+        nbt.putInt("KioCG.TotalFeedingDays", this.totalFeedingDays);
+        nbt.putInt("KioCG.NumberOfProducedToday", this.numberOfProducedToday);
+        // KioCG end
     }
 
     @Override
@@ -139,6 +158,20 @@ public abstract class AgeableMob extends PathfinderMob {
         this.setAge(nbt.getInt("Age"));
         this.forcedAge = nbt.getInt("ForcedAge");
         this.ageLocked = nbt.getBoolean("AgeLocked"); // CraftBukkit
+        // KioCG start
+        if (nbt.contains("KioCG.FeedingDay", net.minecraft.nbt.Tag.TAG_INT)) {
+            this.feedingDay = nbt.getInt("KioCG.FeedingDay");
+        }
+        if (nbt.contains("KioCG.ProduceDay", net.minecraft.nbt.Tag.TAG_INT)) {
+            this.produceDay = nbt.getInt("KioCG.ProduceDay");
+        }
+        if (nbt.contains("KioCG.TotalFeedingDays", net.minecraft.nbt.Tag.TAG_INT)) {
+            this.totalFeedingDays = nbt.getInt("KioCG.TotalFeedingDays");
+        }
+        if (nbt.contains("KioCG.NumberOfProducedToday", net.minecraft.nbt.Tag.TAG_INT)) {
+            this.numberOfProducedToday = nbt.getInt("KioCG.NumberOfProducedToday");
+        }
+        // KioCG end
     }
 
     @Override
@@ -171,6 +204,8 @@ public abstract class AgeableMob extends PathfinderMob {
                 --i;
                 this.setAge(i);
             }
+
+            tickProduce(); // KioCG
         }
 
     }
@@ -204,6 +239,50 @@ public abstract class AgeableMob extends PathfinderMob {
         return (int) ((float) (breedingAge / 20) * 0.1F);
     }
 
+    // KioCG start
+    public void tickProduce() {
+        int days = (int) this.level().getDays();
+
+        if (this.produceDay != 0 && days > this.produceDay) {
+            this.produceDay = 0;
+            ++this.totalFeedingDays;
+            this.numberOfProducedToday = getNumberOfProduced();
+        }
+
+        if (days < this.feedingDay) {
+            this.feedingDay = days;
+            if (this.produceDay != 0) {
+                this.produceDay = this.feedingDay;
+            }
+        }
+    }
+
+    public int getNumberOfProduced() {
+        return 1;
+    }
+
+    public boolean canFeed() {
+        return (int) this.level().getDays() > this.feedingDay;
+    }
+
+    public void feedingFeed() {
+        this.feedingDay = (int) this.level().getDays();
+        this.produceDay = this.feedingDay;
+    }
+
+    public boolean canProduce() {
+        return this.numberOfProducedToday > 0;
+    }
+
+    public void produce() {
+        produce(1);
+    }
+
+    public void produce(int amount) {
+        this.numberOfProducedToday -= amount;
+    }
+    // KioCG end
+
     public static class AgeableMobGroupData implements SpawnGroupData {
 
         private int groupSize;
diff --git a/src/main/java/net/minecraft/world/entity/ai/behavior/AnimalMakeLove.java b/src/main/java/net/minecraft/world/entity/ai/behavior/AnimalMakeLove.java
index 2a7373bb87157540d2ccba6321fb4b1e562beb55..6c00b75f436d7fe958d765cd89284a2391a87fb3 100644
--- a/src/main/java/net/minecraft/world/entity/ai/behavior/AnimalMakeLove.java
+++ b/src/main/java/net/minecraft/world/entity/ai/behavior/AnimalMakeLove.java
@@ -46,6 +46,7 @@ public class AnimalMakeLove extends Behavior<Animal> {
 
     @Override
     protected boolean checkExtraStartConditions(ServerLevel world, Animal entity) {
+        if (!entity.level().paperConfig().kiocgConfig.animal.animalCanBreed) return false; // KioCG
         return entity.isInLove() && this.findValidBreedPartner(entity).isPresent();
     }
 
diff --git a/src/main/java/net/minecraft/world/entity/ai/goal/BreedGoal.java b/src/main/java/net/minecraft/world/entity/ai/goal/BreedGoal.java
index 262653d72d1452b6f17582dbebbcad0c0a49ef63..cc82f9c023686c8cc24b32c045981825a112fdfd 100644
--- a/src/main/java/net/minecraft/world/entity/ai/goal/BreedGoal.java
+++ b/src/main/java/net/minecraft/world/entity/ai/goal/BreedGoal.java
@@ -32,6 +32,7 @@ public class BreedGoal extends Goal {
 
     @Override
     public boolean canUse() {
+        if (!this.animal.level().paperConfig().kiocgConfig.animal.animalCanBreed) return false; // KioCG
         if (!this.animal.isInLove()) {
             return false;
         } else {
diff --git a/src/main/java/net/minecraft/world/entity/animal/Animal.java b/src/main/java/net/minecraft/world/entity/animal/Animal.java
index 5193cf1d3c922d750a11e492b7636215e23ad0d6..5a1d8a0d10afce84987dbd42cafd418ef0328f86 100644
--- a/src/main/java/net/minecraft/world/entity/animal/Animal.java
+++ b/src/main/java/net/minecraft/world/entity/animal/Animal.java
@@ -146,7 +146,7 @@ public abstract class Animal extends AgeableMob {
         if (this.isFood(itemstack)) {
             int i = this.getAge();
 
-            if (!this.level().isClientSide && i == 0 && this.canFallInLove()) {
+            if (!this.level().isClientSide && this.canFeed()) { // KioCG
                 final ItemStack breedCopy = itemstack.copy(); // Paper - Fix EntityBreedEvent copying
                 this.usePlayerItem(player, hand, itemstack);
                 this.setInLove(player, breedCopy); // Paper - Fix EntityBreedEvent copying
@@ -195,6 +195,7 @@ public abstract class Animal extends AgeableMob {
             this.loveCause = player.getUUID();
         }
         // Paper - Fix EntityBreedEvent copying; set breed item in better place
+        this.feedingFeed(); // KioCG
 
         this.level().broadcastEntityEvent(this, (byte) 18);
     }
diff --git a/src/main/java/net/minecraft/world/entity/animal/Chicken.java b/src/main/java/net/minecraft/world/entity/animal/Chicken.java
index 0a4d4cb4ad7cda7c50c46151c03586865d56c797..55eaad136347e132c55915605c16de29ac7d194f 100644
--- a/src/main/java/net/minecraft/world/entity/animal/Chicken.java
+++ b/src/main/java/net/minecraft/world/entity/animal/Chicken.java
@@ -50,7 +50,7 @@ public class Chicken extends Animal {
 
     public Chicken(EntityType<? extends Chicken> type, Level world) {
         super(type, world);
-        this.eggTime = this.random.nextInt(6000) + 6000;
+        this.eggTime = this.random.nextInt(20 * 10); // KioCG
         this.setPathfindingMalus(PathType.WATER, 0.0F);
     }
 
@@ -96,17 +96,25 @@ public class Chicken extends Animal {
         }
 
         this.flap += this.flapping * 2.0F;
-        if (!this.level().isClientSide && this.isAlive() && !this.isBaby() && !this.isChickenJockey() && --this.eggTime <= 0) {
+        if (!this.level().isClientSide && this.isAlive() && !this.isBaby() && this.canProduce() && !this.isChickenJockey() && --this.eggTime <= 0) { // KioCG
             this.playSound(SoundEvents.CHICKEN_EGG, 1.0F, (this.random.nextFloat() - this.random.nextFloat()) * 0.2F + 1.0F);
             this.forceDrops = true; // CraftBukkit
-            this.spawnAtLocation((ItemLike) Items.EGG);
+            this.spawnAtLocation((ItemLike) Items.EGG, this.getNumberOfProducedToday()); // KioCG
             this.forceDrops = false; // CraftBukkit
             this.gameEvent(GameEvent.ENTITY_PLACE);
-            this.eggTime = this.random.nextInt(6000) + 6000;
+            this.eggTime = this.random.nextInt(20 * 10); // KioCG
+            this.produce(this.getNumberOfProducedToday()); // KioCG
         }
 
     }
 
+    // KioCG start
+    @Override
+    public int getNumberOfProduced() {
+        return Math.min(1 + this.getTotalFeedingDays() / 10, 5);
+    }
+    // KioCG end
+
     @Override
     protected boolean isFlapping() {
         return this.flyDist > this.nextFlap;
diff --git a/src/main/java/net/minecraft/world/entity/animal/Cow.java b/src/main/java/net/minecraft/world/entity/animal/Cow.java
index e336934f37075a827843e4b1bb2b6b660d2c60c9..c6322a84a53b4052f24fda6a755900ec8e45cc32 100644
--- a/src/main/java/net/minecraft/world/entity/animal/Cow.java
+++ b/src/main/java/net/minecraft/world/entity/animal/Cow.java
@@ -96,7 +96,7 @@ public class Cow extends Animal {
     public InteractionResult mobInteract(Player player, InteractionHand hand) {
         ItemStack itemstack = player.getItemInHand(hand);
 
-        if (itemstack.is(Items.BUCKET) && !this.isBaby()) {
+        if (itemstack.is(Items.BUCKET) && !this.isBaby() && this.canProduce()) { // KioCG
             // CraftBukkit start - Got milk?
             PlayerBucketFillEvent event = CraftEventFactory.callPlayerBucketFillEvent((ServerLevel) player.level(), player, this.blockPosition(), this.blockPosition(), null, itemstack, Items.MILK_BUCKET, hand);
 
@@ -109,6 +109,7 @@ public class Cow extends Animal {
             player.playSound(SoundEvents.COW_MILK, 1.0F, 1.0F);
             ItemStack itemstack1 = ItemUtils.createFilledResult(itemstack, player, CraftItemStack.asNMSCopy(event.getItemStack())); // CraftBukkit
 
+            this.produce(); // KioCG
             player.setItemInHand(hand, itemstack1);
             return InteractionResult.sidedSuccess(this.level().isClientSide);
         } else {
@@ -116,6 +117,13 @@ public class Cow extends Animal {
         }
     }
 
+    // KioCG start
+    @Override
+    public int getNumberOfProduced() {
+        return Math.min(1 + this.getTotalFeedingDays() / 30, 3);
+    }
+    // KioCG end
+
     @Nullable
     @Override
     public Cow getBreedOffspring(ServerLevel world, AgeableMob entity) {
diff --git a/src/main/java/net/minecraft/world/entity/animal/MushroomCow.java b/src/main/java/net/minecraft/world/entity/animal/MushroomCow.java
index 0c21959f57ae88fcd0a4d6dc911c1ce347c96528..760cdd726d3c242a5214d9995cddb04e587fb0a1 100644
--- a/src/main/java/net/minecraft/world/entity/animal/MushroomCow.java
+++ b/src/main/java/net/minecraft/world/entity/animal/MushroomCow.java
@@ -95,7 +95,7 @@ public class MushroomCow extends Cow implements Shearable, VariantHolder<Mushroo
     public InteractionResult mobInteract(Player player, InteractionHand hand) {
         ItemStack itemstack = player.getItemInHand(hand);
 
-        if (itemstack.is(Items.BOWL) && !this.isBaby()) {
+        if (itemstack.is(Items.BOWL) && !this.isBaby() && this.canProduce()) { // KioCG
             boolean flag = false;
             ItemStack itemstack1;
 
@@ -110,6 +110,7 @@ public class MushroomCow extends Cow implements Shearable, VariantHolder<Mushroo
 
             ItemStack itemstack2 = ItemUtils.createFilledResult(itemstack, player, itemstack1, false);
 
+            this.produce(); // KioCG
             player.setItemInHand(hand, itemstack2);
             SoundEvent soundeffect;
 
diff --git a/src/main/java/net/minecraft/world/entity/animal/Panda.java b/src/main/java/net/minecraft/world/entity/animal/Panda.java
index db60b91c2b26ca8cdb66e05deab7742ffe212767..56dc5f05ad20101f2d74b8042e3a6332a0f5c6ef 100644
--- a/src/main/java/net/minecraft/world/entity/animal/Panda.java
+++ b/src/main/java/net/minecraft/world/entity/animal/Panda.java
@@ -667,7 +667,7 @@ public class Panda extends Animal {
             if (this.isBaby()) {
                 this.usePlayerItem(player, hand, itemstack);
                 this.ageUp((int) ((float) (-this.getAge() / 20) * 0.1F), true);
-            } else if (!this.level().isClientSide && this.getAge() == 0 && this.canFallInLove()) {
+            } else if (!this.level().isClientSide && this.canFeed()) { // KioCG
                 final ItemStack breedCopy = itemstack.copy(); // Paper - Fix EntityBreedEvent copying
                 this.usePlayerItem(player, hand, itemstack);
                 this.setInLove(player, breedCopy); // Paper - Fix EntityBreedEvent copying
diff --git a/src/main/java/net/minecraft/world/entity/animal/Sheep.java b/src/main/java/net/minecraft/world/entity/animal/Sheep.java
index 3ce86f952a18cae7fda1903916903b31a63a40b4..f9a18c6876e6fc8a06519e7c724a005fe8d823cb 100644
--- a/src/main/java/net/minecraft/world/entity/animal/Sheep.java
+++ b/src/main/java/net/minecraft/world/entity/animal/Sheep.java
@@ -153,6 +153,16 @@ public class Sheep extends Animal implements Shearable {
         super.aiStep();
     }
 
+    // KioCG start
+    @Override
+    public void tickProduce() {
+        super.tickProduce();
+        if (this.canProduce() && this.isSheared()) {
+            this.ate();
+        }
+    }
+    // KioCG end
+
     public static AttributeSupplier.Builder createAttributes() {
         return Mob.createMobAttributes().add(Attributes.MAX_HEALTH, 8.0D).add(Attributes.MOVEMENT_SPEED, 0.23000000417232513D);
     }
@@ -256,7 +266,7 @@ public class Sheep extends Animal implements Shearable {
         ItemStack itemstack = player.getItemInHand(hand);
 
         if (itemstack.is(Items.SHEARS)) {
-            if (!this.level().isClientSide && this.readyForShearing()) {
+            if (!this.level().isClientSide && this.readyForShearing() && this.canProduce()) { // KioCG
                 // CraftBukkit start
                 // Paper start - custom shear drops
                 java.util.List<ItemStack> drops = this.generateDefaultDrops();
@@ -269,6 +279,7 @@ public class Sheep extends Animal implements Shearable {
                 }
                 // Paper end - custom shear drops
                 // CraftBukkit end
+                this.produce(); // KioCG
                 this.shear(SoundSource.PLAYERS, drops); // Paper
                 this.gameEvent(GameEvent.SHEAR, player);
                 itemstack.hurtAndBreak(1, player, getSlotForHand(hand));
@@ -281,6 +292,13 @@ public class Sheep extends Animal implements Shearable {
         }
     }
 
+    // KioCG start
+    @Override
+    public int getNumberOfProduced() {
+        return Math.min(1 + this.getTotalFeedingDays() / 15, 5);
+    }
+    // KioCG end
+
     @Override
     public void shear(SoundSource shearedSoundCategory) {
         // Paper start - custom shear drops
@@ -301,6 +319,7 @@ public class Sheep extends Animal implements Shearable {
     public void shear(SoundSource shearedSoundCategory, java.util.List<ItemStack> drops) {
         // Paper end - custom shear drops
         this.level().playSound((Player) null, (Entity) this, SoundEvents.SHEEP_SHEAR, shearedSoundCategory, 1.0F, 1.0F);
+        if (!this.canProduce()) // KioCG
         this.setSheared(true);
         int i = 1 + this.random.nextInt(3);
 
@@ -407,6 +426,7 @@ public class Sheep extends Animal implements Shearable {
         if (event.isCancelled()) return;
         // CraftBukkit end
         super.ate();
+        if (this.canProduce()) // KioCG
         this.setSheared(false);
         if (this.isBaby()) {
             this.ageUp(60);
diff --git a/src/main/java/net/minecraft/world/entity/animal/Turtle.java b/src/main/java/net/minecraft/world/entity/animal/Turtle.java
index 30b87b5cb18c25cdd04eab64cfbe5acd6c1b6d84..c3573f0f69101273d1d2660aefa0f606f6f83b32 100644
--- a/src/main/java/net/minecraft/world/entity/animal/Turtle.java
+++ b/src/main/java/net/minecraft/world/entity/animal/Turtle.java
@@ -187,10 +187,12 @@ public class Turtle extends Animal {
         return pos.getY() < world.getSeaLevel() + 4 && TurtleEggBlock.onSand(world, pos) && isBrightEnoughToSpawn(world, pos);
     }
 
+    private Turtle.TurtleBreedGoal turtleBreedGoal; // KioCG
+
     @Override
     protected void registerGoals() {
         this.goalSelector.addGoal(0, new Turtle.TurtlePanicGoal(this, 1.2D));
-        this.goalSelector.addGoal(1, new Turtle.TurtleBreedGoal(this, 1.0D));
+        this.goalSelector.addGoal(1, turtleBreedGoal = new Turtle.TurtleBreedGoal(this, 1.0D)); // KioCG
         this.goalSelector.addGoal(1, new Turtle.TurtleLayEggGoal(this, 1.0D));
         this.goalSelector.addGoal(2, new TemptGoal(this, 1.1D, (itemstack) -> {
             return itemstack.is(ItemTags.TURTLE_FOOD);
@@ -301,6 +303,17 @@ public class Turtle extends Animal {
 
     }
 
+    // KioCG start
+    @Override
+    public void tickProduce() {
+        super.tickProduce();
+        if (this.canProduce()) {
+            this.produce();
+            turtleBreedGoal.breed();
+        }
+    }
+    // KioCG end
+
     @Override
     protected void ageBoundaryReached() {
         super.ageBoundaryReached();
diff --git a/src/main/java/net/minecraft/world/entity/animal/camel/Camel.java b/src/main/java/net/minecraft/world/entity/animal/camel/Camel.java
index 4eb26874f21726bbc6e6ad78bfaf4ecd268c7246..cf8964ff47ef086202a35bdfecfaa35b04062393 100644
--- a/src/main/java/net/minecraft/world/entity/animal/camel/Camel.java
+++ b/src/main/java/net/minecraft/world/entity/animal/camel/Camel.java
@@ -386,7 +386,7 @@ public class Camel extends AbstractHorse implements PlayerRideableJumping, Saddl
                 this.heal(2.0F, org.bukkit.event.entity.EntityRegainHealthEvent.RegainReason.EATING); // Paper - Add missing regain reason
             }
 
-            boolean flag1 = this.isTamed() && this.getAge() == 0 && this.canFallInLove();
+            boolean flag1 = this.isTamed() && this.canFeed(); // KioCG
 
             if (flag1) {
                 this.setInLove(player, item.copy()); // Paper - Fix EntityBreedEvent copying
diff --git a/src/main/java/net/minecraft/world/entity/animal/frog/Frog.java b/src/main/java/net/minecraft/world/entity/animal/frog/Frog.java
index 816977990639ec0559b652fc9666afd5046f0a5d..c1e7cb7924f8ea0e33c487193a0bb2ad83fc1f28 100644
--- a/src/main/java/net/minecraft/world/entity/animal/frog/Frog.java
+++ b/src/main/java/net/minecraft/world/entity/animal/frog/Frog.java
@@ -201,6 +201,17 @@ public class Frog extends Animal implements VariantHolder<Holder<FrogVariant>> {
         super.tick();
     }
 
+    // KioCG start
+    @Override
+    public void tickProduce() {
+        super.tickProduce();
+        if (this.canProduce()) {
+            this.produce();
+            this.spawnChildFromBreeding((ServerLevel) this.level(), this);
+        }
+    }
+    // KioCG end
+
     @Override
     public void onSyncedDataUpdated(EntityDataAccessor<?> data) {
         if (DATA_POSE.equals(data)) {
diff --git a/src/main/java/net/minecraft/world/entity/animal/goat/Goat.java b/src/main/java/net/minecraft/world/entity/animal/goat/Goat.java
index 376bcbc189008464f4d518c1e07643431ba96306..b1af4fab67512662d12008c03b5a4fcddfaf1860 100644
--- a/src/main/java/net/minecraft/world/entity/animal/goat/Goat.java
+++ b/src/main/java/net/minecraft/world/entity/animal/goat/Goat.java
@@ -229,7 +229,7 @@ public class Goat extends Animal {
     public InteractionResult mobInteract(Player player, InteractionHand hand) {
         ItemStack itemstack = player.getItemInHand(hand);
 
-        if (itemstack.is(Items.BUCKET) && !this.isBaby()) {
+        if (itemstack.is(Items.BUCKET) && !this.isBaby() && this.canProduce()) { // KioCG
             // CraftBukkit start - Got milk?
             PlayerBucketFillEvent event = CraftEventFactory.callPlayerBucketFillEvent((ServerLevel) player.level(), player, this.blockPosition(), this.blockPosition(), null, itemstack, Items.MILK_BUCKET, hand);
 
@@ -241,6 +241,7 @@ public class Goat extends Animal {
             player.playSound(this.getMilkingSound(), 1.0F, 1.0F);
             ItemStack itemstack1 = ItemUtils.createFilledResult(itemstack, player, CraftItemStack.asNMSCopy(event.getItemStack())); // CraftBukkit
 
+            this.produce(); // KioCG
             player.setItemInHand(hand, itemstack1);
             return InteractionResult.sidedSuccess(this.level().isClientSide);
         } else {
@@ -255,6 +256,13 @@ public class Goat extends Animal {
         }
     }
 
+    // KioCG start
+    @Override
+    public int getNumberOfProduced() {
+        return Math.min(1 + this.getTotalFeedingDays() / 25, 3);
+    }
+    // KioCG end
+
     @Override
     public SpawnGroupData finalizeSpawn(ServerLevelAccessor world, DifficultyInstance difficulty, MobSpawnType spawnReason, @Nullable SpawnGroupData entityData) {
         RandomSource randomsource = world.getRandom();
diff --git a/src/main/java/net/minecraft/world/entity/animal/horse/AbstractHorse.java b/src/main/java/net/minecraft/world/entity/animal/horse/AbstractHorse.java
index 9357cf0179d19fbdfe76413e909a99b924c85780..b9452549ed342890b9f4d2f4e48bd0ab2658720a 100644
--- a/src/main/java/net/minecraft/world/entity/animal/horse/AbstractHorse.java
+++ b/src/main/java/net/minecraft/world/entity/animal/horse/AbstractHorse.java
@@ -569,7 +569,7 @@ public abstract class AbstractHorse extends Animal implements ContainerListener,
             f = 4.0F;
             short0 = 60;
             b0 = 5;
-            if (!this.level().isClientSide && this.isTamed() && this.getAge() == 0 && !this.isInLove()) {
+            if (!this.level().isClientSide && this.isTamed() && this.canFeed()) { // KioCG
                 flag = true;
                 this.setInLove(player, item.copy()); // Paper - Fix EntityBreedEvent copying
             }
@@ -577,7 +577,7 @@ public abstract class AbstractHorse extends Animal implements ContainerListener,
             f = 10.0F;
             short0 = 240;
             b0 = 10;
-            if (!this.level().isClientSide && this.isTamed() && this.getAge() == 0 && !this.isInLove()) {
+            if (!this.level().isClientSide && this.isTamed() && this.canFeed()) { // KioCG
                 flag = true;
                 this.setInLove(player, item.copy()); // Paper - Fix EntityBreedEvent copying
             }
diff --git a/src/main/java/net/minecraft/world/entity/animal/horse/Llama.java b/src/main/java/net/minecraft/world/entity/animal/horse/Llama.java
index 36d654073ab4058db54830d9447d7d959a0b25f1..66eff5e586b9973e9854012f7a31b2c3a92cc3eb 100644
--- a/src/main/java/net/minecraft/world/entity/animal/horse/Llama.java
+++ b/src/main/java/net/minecraft/world/entity/animal/horse/Llama.java
@@ -182,7 +182,7 @@ public class Llama extends AbstractChestedHorse implements VariantHolder<Llama.V
             b0 = 90;
             b1 = 6;
             f = 10.0F;
-            if (this.isTamed() && this.getAge() == 0 && this.canFallInLove()) {
+            if (this.isTamed() && this.canFeed()) { // KioCG
                 flag = true;
                 this.setInLove(player, item.copy()); // Paper - Fix EntityBreedEvent copying
             }
diff --git a/src/main/java/net/minecraft/world/entity/animal/sniffer/Sniffer.java b/src/main/java/net/minecraft/world/entity/animal/sniffer/Sniffer.java
index dc035bf94c5f6574ed8ad369b327b7f7a145e1d6..57eeca8b8bbd1ef0827cd27b7f88b442ea8f6ee0 100644
--- a/src/main/java/net/minecraft/world/entity/animal/sniffer/Sniffer.java
+++ b/src/main/java/net/minecraft/world/entity/animal/sniffer/Sniffer.java
@@ -485,6 +485,17 @@ public class Sniffer extends Animal {
         super.customServerAiStep();
     }
 
+    // KioCG start
+    @Override
+    public void tickProduce() {
+        super.tickProduce();
+        if (this.canProduce()) {
+            this.produce();
+            this.spawnChildFromBreeding((ServerLevel) this.level(), this);
+        }
+    }
+    // KioCG end
+
     @Override
     protected void sendDebugPackets() {
         super.sendDebugPackets();
diff --git a/src/main/java/net/minecraft/world/entity/npc/Villager.java b/src/main/java/net/minecraft/world/entity/npc/Villager.java
index a7930f9875aa4aca997caaead46ecdc21e5e11d7..bf47a262adcbb02bbc2f490ae398f9eab0d73a0c 100644
--- a/src/main/java/net/minecraft/world/entity/npc/Villager.java
+++ b/src/main/java/net/minecraft/world/entity/npc/Villager.java
@@ -738,6 +738,7 @@ public class Villager extends AbstractVillager implements ReputationEventHandler
 
     @Override
     public boolean canBreed() {
+        if (!this.level().paperConfig().kiocgConfig.animal.animalCanBreed) return false; // KioCG
         return this.foodLevel + this.countFoodPointsInInventory() >= 12 && !this.isSleeping() && this.getAge() == 0;
     }
 
diff --git a/src/main/java/net/minecraft/world/level/storage/loot/functions/LootingEnchantFunction.java b/src/main/java/net/minecraft/world/level/storage/loot/functions/LootingEnchantFunction.java
index cfe953bc924f46b570e37395ac0f05ebcb82eb39..b06b5ccbcc412801e0942342752707628ab772a5 100644
--- a/src/main/java/net/minecraft/world/level/storage/loot/functions/LootingEnchantFunction.java
+++ b/src/main/java/net/minecraft/world/level/storage/loot/functions/LootingEnchantFunction.java
@@ -54,6 +54,7 @@ public class LootingEnchantFunction extends LootItemConditionalFunction {
     @Override
     public ItemStack run(ItemStack stack, LootContext context) {
         Entity entity = (Entity) context.getParamOrNull(LootContextParams.KILLER_ENTITY);
+        int i0 = 0; // KioCG
 
         if (entity instanceof LivingEntity) {
             int i = EnchantmentHelper.getMobLooting((LivingEntity) entity);
@@ -62,6 +63,13 @@ public class LootingEnchantFunction extends LootItemConditionalFunction {
                 i = context.getParamOrNull(LootContextParams.LOOTING_MOD);
             }
             // CraftBukkit end
+            // KioCG start
+            i0 = i;
+        }
+        {
+            int i = i0;
+            if (context.getParamOrNull(LootContextParams.THIS_ENTITY) instanceof net.minecraft.world.entity.AgeableMob ageableMob) i += ageableMob.getTotalFeedingDays() * 4;
+            // KioCG end
 
             if (i <= 0) { // CraftBukkit - account for possible negative looting values from Bukkit
                 return stack;
diff --git a/src/main/java/net/minecraft/world/level/storage/loot/predicates/LootItemRandomChanceWithLootingCondition.java b/src/main/java/net/minecraft/world/level/storage/loot/predicates/LootItemRandomChanceWithLootingCondition.java
index e2603e5ec9134e293bd6cdf6bde549285eda496b..2add849aed08c81e753f82c2c0a96e7c2a843829 100644
--- a/src/main/java/net/minecraft/world/level/storage/loot/predicates/LootItemRandomChanceWithLootingCondition.java
+++ b/src/main/java/net/minecraft/world/level/storage/loot/predicates/LootItemRandomChanceWithLootingCondition.java
@@ -35,6 +35,7 @@ public record LootItemRandomChanceWithLootingCondition(float percent, float loot
         if (entity instanceof LivingEntity) {
             i = EnchantmentHelper.getMobLooting((LivingEntity) entity);
         }
+        if (loottableinfo.getParamOrNull(LootContextParams.THIS_ENTITY) instanceof net.minecraft.world.entity.AgeableMob ageableMob) i += ageableMob.getTotalFeedingDays() * 4; // KioCG
         // CraftBukkit start - only use lootingModifier if set by Bukkit
         if (loottableinfo.hasParam(LootContextParams.LOOTING_MOD)) {
             i = loottableinfo.getParamOrNull(LootContextParams.LOOTING_MOD);
