From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Joket_abc <15005771700@qq.com>
Date: Wed, 5 Jun 2024 16:03:11 +0800
Subject: [PATCH] Transform spawned via mob spawner


diff --git a/src/main/java/net/minecraft/world/entity/Mob.java b/src/main/java/net/minecraft/world/entity/Mob.java
index 87bf31f61898246dc0f2e792148c39d75dc3f676..0fd0366ec91f77e16706d54431002dfec434bdf7 100644
--- a/src/main/java/net/minecraft/world/entity/Mob.java
+++ b/src/main/java/net/minecraft/world/entity/Mob.java
@@ -1624,6 +1624,7 @@ public abstract class Mob extends LivingEntity implements EquipmentUser, Leashab
                     return null;
                 }
                 this.level().addFreshEntity(t0, spawnReason);
+                t0.spawnedViaMobSpawner = this.spawnedViaMobSpawner; // KioCG
                 // CraftBukkit end
                 if (this.isPassenger()) {
                     Entity entity = this.getVehicle();
diff --git a/src/main/java/net/minecraft/world/entity/animal/MushroomCow.java b/src/main/java/net/minecraft/world/entity/animal/MushroomCow.java
index 760cdd726d3c242a5214d9995cddb04e587fb0a1..e28bfd3420654addf19c569fed9f513583a2dfab 100644
--- a/src/main/java/net/minecraft/world/entity/animal/MushroomCow.java
+++ b/src/main/java/net/minecraft/world/entity/animal/MushroomCow.java
@@ -213,6 +213,7 @@ public class MushroomCow extends Cow implements Shearable, VariantHolder<Mushroo
                     return;
                 }
                 this.level().addFreshEntity(entitycow, org.bukkit.event.entity.CreatureSpawnEvent.SpawnReason.SHEARED);
+                entitycow.spawnedViaMobSpawner = this.spawnedViaMobSpawner; // KioCG
 
                 this.discard(EntityRemoveEvent.Cause.TRANSFORMATION); // CraftBukkit - from above and add Bukkit remove cause
                 // CraftBukkit end
diff --git a/src/main/java/net/minecraft/world/entity/animal/Pig.java b/src/main/java/net/minecraft/world/entity/animal/Pig.java
index 25cb56db335a3938959166e6bf4d8479f4b61c19..252c6a8cfeb9afbc9d0d5f5435b68a151a1d2b1b 100644
--- a/src/main/java/net/minecraft/world/entity/animal/Pig.java
+++ b/src/main/java/net/minecraft/world/entity/animal/Pig.java
@@ -265,6 +265,7 @@ public class Pig extends Animal implements ItemSteerable, Saddleable {
                 }
                 // CraftBukkit - added a reason for spawning this creature
                 world.addFreshEntity(entitypigzombie, org.bukkit.event.entity.CreatureSpawnEvent.SpawnReason.LIGHTNING);
+                entitypigzombie.spawnedViaMobSpawner = this.spawnedViaMobSpawner; // KioCG
                 // CraftBukkit end
                 this.discard(EntityRemoveEvent.Cause.TRANSFORMATION); // CraftBukkit - add Bukkit remove cause
             } else {
diff --git a/src/main/java/net/minecraft/world/entity/animal/frog/Tadpole.java b/src/main/java/net/minecraft/world/entity/animal/frog/Tadpole.java
index 43046f4a0cff620834ac4647efdcde227185b2ff..e60cbd654c62d52e07763793e45191a71e573112 100644
--- a/src/main/java/net/minecraft/world/entity/animal/frog/Tadpole.java
+++ b/src/main/java/net/minecraft/world/entity/animal/frog/Tadpole.java
@@ -250,6 +250,7 @@ public class Tadpole extends AbstractFish {
                 frog.fudgePositionAfterSizeChange(this.getDimensions(this.getPose()));
                 this.playSound(SoundEvents.TADPOLE_GROW_UP, 0.15F, 1.0F);
                 worldserver.addFreshEntityWithPassengers(frog, org.bukkit.event.entity.CreatureSpawnEvent.SpawnReason.METAMORPHOSIS); // CraftBukkit - add SpawnReason
+                frog.spawnedViaMobSpawner = this.spawnedViaMobSpawner; // KioCG
                 this.discard(EntityRemoveEvent.Cause.TRANSFORMATION); // CraftBukkit - add Bukkit remove cause
             }
         }
diff --git a/src/main/java/net/minecraft/world/entity/monster/Slime.java b/src/main/java/net/minecraft/world/entity/monster/Slime.java
index adebb66e550f805f444bec22e9a4dd575a642b43..9b83f8f2e1d38e85aea6dc749a0c1b07724460d3 100644
--- a/src/main/java/net/minecraft/world/entity/monster/Slime.java
+++ b/src/main/java/net/minecraft/world/entity/monster/Slime.java
@@ -270,6 +270,7 @@ public class Slime extends Mob implements Enemy {
             }
             for (LivingEntity living : slimes) {
                 this.level().addFreshEntity(living, org.bukkit.event.entity.CreatureSpawnEvent.SpawnReason.SLIME_SPLIT); // CraftBukkit - SpawnReason
+                living.spawnedViaMobSpawner = this.spawnedViaMobSpawner; // KioCG
             }
             // CraftBukkit end
         }
diff --git a/src/main/java/net/minecraft/world/entity/npc/Villager.java b/src/main/java/net/minecraft/world/entity/npc/Villager.java
index 0da3203ed998dddd6348e50786f7ef5b68585cd4..846d01df32a5b57dc631169c5124da15e222c4d9 100644
--- a/src/main/java/net/minecraft/world/entity/npc/Villager.java
+++ b/src/main/java/net/minecraft/world/entity/npc/Villager.java
@@ -925,6 +925,7 @@ public class Villager extends AbstractVillager implements ReputationEventHandler
                     return;
                 }
                 world.addFreshEntityWithPassengers(entitywitch, org.bukkit.event.entity.CreatureSpawnEvent.SpawnReason.LIGHTNING);
+                entitywitch.spawnedViaMobSpawner = this.spawnedViaMobSpawner; // KioCG
                 // CraftBukkit end
                 this.releaseAllPois();
                 this.discard(EntityRemoveEvent.Cause.TRANSFORMATION); // CraftBukkit - add Bukkit remove cause
