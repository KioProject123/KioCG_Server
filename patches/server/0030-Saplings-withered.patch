From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Joket_abc <15005771700@qq.com>
Date: Sun, 17 Mar 2024 13:55:25 +0800
Subject: [PATCH] Saplings withered


diff --git a/src/main/java/io/papermc/paper/configuration/WorldConfiguration.java b/src/main/java/io/papermc/paper/configuration/WorldConfiguration.java
index 683b25cb32d79041816dd0b045660e8aecf58158..e7a95d6bd9b422593bb2c2561d21b8845e387988 100644
--- a/src/main/java/io/papermc/paper/configuration/WorldConfiguration.java
+++ b/src/main/java/io/papermc/paper/configuration/WorldConfiguration.java
@@ -643,6 +643,7 @@ public class WorldConfiguration extends ConfigurationPart {
 
         public boolean sleepAnyTime = true;
         public double sleepHealingRegenRate = 20.0;
+        public double saplingsWitheredChance = 0.025;
     }
     // KioCG end
 }
diff --git a/src/main/java/net/minecraft/world/level/block/MangrovePropaguleBlock.java b/src/main/java/net/minecraft/world/level/block/MangrovePropaguleBlock.java
index ff3fbca8d1e6c731e9441c4f4a6e5dc657ce5403..c849965f3f61cddbbc8feb2459c53c75ae330862 100644
--- a/src/main/java/net/minecraft/world/level/block/MangrovePropaguleBlock.java
+++ b/src/main/java/net/minecraft/world/level/block/MangrovePropaguleBlock.java
@@ -115,6 +115,13 @@ public class MangrovePropaguleBlock extends SaplingBlock implements SimpleWaterl
     protected void randomTick(BlockState state, ServerLevel world, BlockPos pos, RandomSource random) {
         if (!isHanging(state)) {
             if (random.nextFloat() < (world.spigotConfig.saplingModifier / 100.0F)) { // Paper - Fix Spigot growth modifiers // KioCG
+                // KioCG start
+                if (random.nextDouble() < world.paperConfig().kiocgConfig.saplingsWitheredChance) {
+                    world.setBlock(pos, Blocks.DEAD_BUSH.defaultBlockState(), 3);
+                    return;
+                }
+                // KioCG end
+
                 this.advanceTree(world, pos, state, random);
             }
         } else {
diff --git a/src/main/java/net/minecraft/world/level/block/SaplingBlock.java b/src/main/java/net/minecraft/world/level/block/SaplingBlock.java
index d8a8e040e2f7e7488d8ae1699e9ad4702e4e395a..eca7c524cf353b432abfb4dd2a9675787507e387 100644
--- a/src/main/java/net/minecraft/world/level/block/SaplingBlock.java
+++ b/src/main/java/net/minecraft/world/level/block/SaplingBlock.java
@@ -63,6 +63,13 @@ public class SaplingBlock extends BushBlock implements BonemealableBlock {
     @Override
     protected void randomTick(net.minecraft.world.level.block.state.BlockState state, ServerLevel world, BlockPos pos, RandomSource random) {
         if (world.getMaxLocalRawBrightness(pos.above()) >= 9 && random.nextFloat() < (world.spigotConfig.saplingModifier / 100.0f)) { // Spigot - SPIGOT-7159: Better modifier resolution // KioCG
+            // KioCG start
+            if (random.nextDouble() < world.paperConfig().kiocgConfig.saplingsWitheredChance) {
+                world.setBlock(pos, Blocks.DEAD_BUSH.defaultBlockState(), 3);
+                return;
+            }
+            // KioCG end
+
             this.advanceTree(world, pos, state, random);
         }
 
